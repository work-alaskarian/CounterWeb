<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <title>API Test - ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿ©</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        .container { max-width: 1000px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .result { margin: 10px 0; }
        .loading { color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç API Endpoints Test</h1>

        <div class="section info">
            <h2>üîß Configuration</h2>
            <p><strong>API Base URL:</strong> <span id="baseUrl">http://10.10.1.205:8080</span></p>
            <p><strong>GraphQL Endpoint:</strong> <span id="graphqlUrl">http://10.10.1.205:8080/graphql</span></p>
            <p><strong>WebSocket URL:</strong> <span id="wsUrl">ws://10.10.1.205:8080/ws/analytics</span></p>
        </div>

        <div class="section">
            <h2>üè• Server Health Check</h2>
            <button onclick="testHealth()">Test /health</button>
            <button onclick="testRoot()">Test / (root)</button>
            <div id="health-result" class="result"></div>
        </div>

        <div class="section">
            <h2>üìç Locations API</h2>
            <button onclick="testLocations()">Test /api/locations</button>
            <button onclick="testGraphQLLocations()">Test GraphQL Locations</button>
            <div id="locations-result" class="result"></div>
        </div>

        <div class="section">
            <h2>üìä Analytics API</h2>
            <button onclick="testAnalyticsSummary()">Test Analytics Summary</button>
            <button onclick="testLiveData()">Test Live Data</button>
            <div id="analytics-result" class="result"></div>
        </div>

        <div class="section">
            <h2>üé• Cameras API</h2>
            <button onclick="testCameras()">Test Cameras</button>
            <div id="cameras-result" class="result"></div>
        </div>

        <div class="section">
            <h2>üìà Chart Data API</h2>
            <button onclick="testChartData()">Test Chart Data</button>
            <div id="chart-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://10.10.1.205:8080';
        const GRAPHQL_ENDPOINT = `${API_BASE}/graphql`;

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result section ${type}`;
            element.innerHTML = content;
        }

        function showLoading(elementId) {
            showResult(elementId, '<p class="loading">üîÑ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>');
        }

        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    timeout: 10000,
                    ...options
                });

                const responseData = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data: null
                };

                try {
                    responseData.data = await response.json();
                } catch {
                    responseData.data = await response.text();
                }

                return responseData;
            } catch (error) {
                return {
                    error: error.message,
                    status: 'Network Error'
                };
            }
        }

        async function testHealth() {
            showLoading('health-result');
            const result = await makeRequest(`${API_BASE}/health`);

            if (result.error) {
                showResult('health-result', `
                    <h3>‚ùå Health Check Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('health-result', `
                    <h3>‚úÖ Health Check Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testRoot() {
            showLoading('health-result');
            const result = await makeRequest(`${API_BASE}/`);

            if (result.error) {
                showResult('health-result', `
                    <h3>‚ùå Root Endpoint Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('health-result', `
                    <h3>‚úÖ Root Endpoint Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testLocations() {
            showLoading('locations-result');
            const result = await makeRequest(`${API_BASE}/api/locations`);

            if (result.error) {
                showResult('locations-result', `
                    <h3>‚ùå Locations API Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('locations-result', `
                    <h3>‚úÖ Locations API Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testGraphQLLocations() {
            showLoading('locations-result');
            const query = `
                query GetAllLocations {
                    locations {
                        id
                        name
                        liveCount
                        status
                    }
                }
            `;

            const result = await makeRequest(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query })
            });

            if (result.error) {
                showResult('locations-result', `
                    <h3>‚ùå GraphQL Locations Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('locations-result', `
                    <h3>‚úÖ GraphQL Locations Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testAnalyticsSummary() {
            showLoading('analytics-result');
            const query = `
                query GetAnalyticsSummary($timeframe: String!) {
                    analyticsSummary(timeframe: $timeframe) {
                        totalVisitors
                        averageStayTime
                        peakHour
                        mostVisitedLocation
                        timestamp
                    }
                }
            `;

            const result = await makeRequest(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query,
                    variables: { timeframe: 'HOURLY' }
                })
            });

            if (result.error) {
                showResult('analytics-result', `
                    <h3>‚ùå Analytics Summary Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('analytics-result', `
                    <h3>‚úÖ Analytics Summary Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testLiveData() {
            showLoading('analytics-result');
            const query = `
                query GetLiveData {
                    locations {
                        id
                        name
                        liveCount
                        lastUpdate
                    }
                }
            `;

            const result = await makeRequest(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query })
            });

            if (result.error) {
                showResult('analytics-result', `
                    <h3>‚ùå Live Data Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('analytics-result', `
                    <h3>‚úÖ Live Data Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testCameras() {
            showLoading('cameras-result');
            const query = `
                query GetCameras {
                    cameras {
                        id
                        name
                        location
                        status
                        lastPing
                    }
                }
            `;

            const result = await makeRequest(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query })
            });

            if (result.error) {
                showResult('cameras-result', `
                    <h3>‚ùå Cameras API Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('cameras-result', `
                    <h3>‚úÖ Cameras API Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        async function testChartData() {
            showLoading('chart-result');
            const query = `
                query GetChartData($locationId: String!, $timeframe: String!, $limit: Int) {
                    chartData(locationId: $locationId, timeframe: $timeframe, limit: $limit) {
                        timestamp
                        count
                        location
                    }
                }
            `;

            const result = await makeRequest(GRAPHQL_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    query,
                    variables: {
                        locationId: 'all',
                        timeframe: 'HOURLY',
                        limit: 20
                    }
                })
            });

            if (result.error) {
                showResult('chart-result', `
                    <h3>‚ùå Chart Data Failed</h3>
                    <p><strong>Error:</strong> ${result.error}</p>
                `, 'error');
            } else {
                showResult('chart-result', `
                    <h3>‚úÖ Chart Data Response</h3>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <pre>${JSON.stringify(result.data, null, 2)}</pre>
                `, result.status === 200 ? 'success' : 'error');
            }
        }

        // Auto-run basic tests on page load
        window.onload = function() {
            console.log('üîç API Test Page Loaded');
            testHealth();
        };
    </script>
</body>
</html>